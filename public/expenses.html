<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Expenses | BrokeWho?</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- NAVBAR -->
  <nav>
    <div class="nav-inner">
      <h3>BrokeWho?</h3>
      <div class="nav-controls">
        <button class="secondary" id="themeToggle">ðŸŒ“ Theme</button>
        <a href="dashboard.html">Dashboard</a>
        <button class="secondary" id="logoutBtn">Logout</button>
      </div>

    </div>
  </nav>

  <!-- MAIN -->
  <div class="container">
    <h2>Your Expenses</h2>

    <!-- ADD EXPENSE -->
    <div class="card">
      <label>Category</label>
      <input id="category" placeholder="Food, Rent, Travel..." />

      <label>Amount</label>
      <input id="amount" type="number" placeholder="â‚¹ Amount" />

      <button onclick="addExpense()">Add Expense</button>
    </div>

    <!-- LIST -->
    <div class="card">
      <ul id="list"></ul>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "login.html";
        return;
      }
      // Theme toggle (same as dashboard)
      const themeToggle = document.getElementById("themeToggle");
      if (themeToggle) {
        themeToggle.onclick = () => {
          const current = document.documentElement.getAttribute("data-theme");
          document.documentElement.setAttribute(
            "data-theme",
            current === "dark" ? "light" : "dark"
          );
        };
      }
      // Load saved theme
const savedTheme = localStorage.getItem("theme");
if (savedTheme) {
  document.documentElement.setAttribute("data-theme", savedTheme);
}


      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("token");
          window.location.href = "login.html";
        });
      }

      const list = document.getElementById("list");

      async function loadExpenses() {
        const res = await fetch("/api/expenses", {
          headers: { Authorization: "Bearer " + token }
        });

        const data = await res.json();
        list.innerHTML = "";

        if (data.length === 0) {
          list.innerHTML = "<div class='muted'>No expenses yet</div>";
          return;
        }

        data.forEach(e => {
          const li = document.createElement("li");
          li.innerHTML = `
        <span>${e.category} â€” â‚¹${e.amount}</span>
        <button class="danger" onclick="deleteExpense(${e.id})">âœ•</button>
      `;
          list.appendChild(li);
        });
      }

      window.addExpense = async function () {
        const category = document.getElementById("category").value.trim();
        const amount = document.getElementById("amount").value;

        if (!category || !amount) return alert("Fill all fields");

        await fetch("/api/expenses", {
          method: "POST",
          headers: {
            Authorization: "Bearer " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ category, amount })
        });

        document.getElementById("category").value = "";
        document.getElementById("amount").value = "";
        loadExpenses();
      };

      window.deleteExpense = async function (id) {
        await fetch(`/api/expenses/${id}`, {
          method: "DELETE",
          headers: { Authorization: "Bearer " + token }
        });
        loadExpenses();
      };

      loadExpenses();
    });
  </script>


</body>

</html>